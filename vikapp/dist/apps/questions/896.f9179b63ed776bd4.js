/*! For license information please see 896.f9179b63ed776bd4.js.LICENSE.txt */
(self.webpackChunkquestions=self.webpackChunkquestions||[]).push([[896],{896:(e,t,n)=>{n.d(t,{c:()=>J});var s=n(640),a=n(796),o=n(28);const i=[{id:1,name:"answer1",value:""},{id:2,name:"answer2",value:""},{id:3,name:"answer3",value:""},{id:4,name:"answer4",value:""}],r={questionSlide:!1,questionType:"",questionData:void 0,addQuestion:{text:"",category:0,answers:i,answerright:0}},u=(0,a.createSlice)({name:"questionApp",initialState:r,reducers:{showQuestionSlide:(e,t)=>{e.questionSlide=t.payload},typeQuestion:(e,t)=>{e.questionType=t.payload},dataQuestion:(e,t)=>{e.questionData=t.payload},getQuestionText:(e,t)=>{e.addQuestion.text=t.payload},getQuestionCategory:(e,t)=>{e.addQuestion.category=t.payload},getQuestionAnswers:(e,t)=>{e.addQuestion.answers=t.payload},getQuestionAnswerright:(e,t)=>{e.addQuestion.answerright=t.payload},getQuestionDefault:e=>{e.addQuestion.text="",e.addQuestion.category=0,e.addQuestion.answers=i,e.addQuestion.answerright=0}}}),{showQuestionSlide:l,typeQuestion:c,dataQuestion:d,getQuestionText:p,getQuestionCategory:h,getQuestionAnswerright:x,getQuestionDefault:g,getQuestionAnswers:m}=u.actions,y=e=>e.questionApp.questionSlide,v=e=>e.questionApp.questionType,f=e=>e.questionApp.addQuestion.text,j=e=>e.questionApp.addQuestion.category,w=e=>e.questionApp.addQuestion,Q=u.reducer,b=(0,a.configureStore)({reducer:{[o.K.reducerPath]:o.K.reducer,questionApp:Q},middleware:e=>e().concat(o.K.middleware)}),q=()=>(0,s.useDispatch)(),S=s.useSelector;var T=n(184);const B=o.K.injectEndpoints({endpoints:e=>({getQuestionById:e.query({query:e=>({url:`question/findById/${e}`})}),getQuestionByChat:e.query({query:e=>({url:`question/findByChatId/${e}`})}),updateQuestion:e.mutation({query:({id:e,question:t})=>({url:`/question/${e}`,method:"PATCH",body:{question:t}})}),addQuestion:e.mutation({query:e=>({url:"/question",method:"POST",body:e})}),deleteQuestion:e.mutation({query:e=>({url:"/chat-category",method:"DELETE",body:{id:e}})}),countAvailableQuestion:e.query({query:e=>({url:`auto-post/countAvailableQuestionByChatId/${e}`}),providesTags:["CountAvailableQuestionGroup"]}),countPublishedQuestion:e.query({query:e=>({url:`auto-post/countPublishedQuestion/${e}`}),providesTags:["CountAvailableQuestionGroup"]})})}),{useGetQuestionByChatQuery:C,useGetQuestionByIdQuery:A,useAddQuestionMutation:M,useDeleteQuestionMutation:I,useUpdateQuestionMutation:_,useCountAvailableQuestionQuery:k,useCountPublishedQuestionQuery:N}=B;var P=n(460),G=n(0);const E=({chat:e})=>{const{isLoading:t,data:n,isSuccess:s}=C(e);return(0,G.jsxs)(G.Fragment,{children:[t&&(0,G.jsx)(T.Preloader,{}),s&&n.map((e=>(0,G.jsx)("li",{className:"cursor-pointer",children:(0,G.jsx)(T.SimpleAccordionMain,{description:(0,G.jsxs)(T.SimpleAccordionText,{children:[(0,G.jsxs)("span",{className:"text-xs text-[var(--tg-theme-hint-color)]",children:["Дата: ",String(e.dateadd)]}),(0,G.jsx)("p",{className:"line-clamp-3",children:e.text}),(0,G.jsxs)("span",{className:"text-xs text-[var(--tg-theme-hint-color)]",children:["Категория: ",e.category]})]}),content:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(T.ButtonIcon,{firstIcon:!0,text:"Модерировать",color:"[var(--tg-theme-accent-text-color)]",icon:"moderate",func:P._W}),(0,G.jsx)(T.ButtonIcon,{firstIcon:!0,text:"Статистика",color:"[var(--tg-theme-accent-text-color)]",icon:"stat",func:P._W}),(0,G.jsx)(T.ButtonIcon,{firstIcon:!0,text:"Отправить",color:"[var(--tg-theme-accent-text-color)]",icon:"send",func:P._W}),(0,G.jsx)(T.ButtonIconConfirm,{firstIcon:!0,text:"Удалить",color:"red-500",icon:"delete",func:P._g,textConfirm:`Вы действительно хотите удалить вопрос №${s?n[0].id:"не success"}`})]})})})))]})},F=()=>(0,G.jsx)("ul",{role:"list",className:"divide-y divide-[var(--tg-theme-hint-color)]",children:(0,G.jsx)(E,{chat:521884639})});var O=n(136);function D({validate:e}){const t=window.Telegram.WebApp,n=S(f),s=q(),[a,o]=(0,O.useState)(""),[i,r]=(0,O.useState)(!1);(0,O.useEffect)((()=>{const e=e=>e?u(n):s(g());setTimeout((()=>{""!=n&&t.showConfirm("Применить несохранённый черновик?",e)}),1500)}),[]),e(!!i);const u=e=>{o(e),s(p(e))};return(0,G.jsx)(G.Fragment,{children:(0,G.jsxs)("div",{className:"py-2",children:[(0,G.jsx)(T.SimpleTextArea,{label:"Текст вопроса:",rows:5,value:a,func:e=>u(e.target.value)}),(0,G.jsx)("div",{className:"py-4",children:(0,G.jsx)(T.ValidateForm,{text:"Длина текста вопроса должна быть не менее 10 не более 250 символов",data:{value:a,lengthMin:10,lengthMax:250},validation:r})})]})})}function W({step:e,stepsCount:t}){let n=[];for(let s=0;s<t;s++)n.push({id:s,status:e>s?"complete":"upcoming"});return(0,G.jsxs)("nav",{className:"flex items-center px-8 pt-8 pb-4 bg-[var(--tg-theme-bg-color)] space-x-3 justify-center","aria-label":"Progress",children:[(0,G.jsxs)("p",{className:"text-sm font-medium text-[var(--tg-theme-accent-text-color)]",children:["Шаг ",e," из ",t]}),(0,G.jsx)("ol",{role:"list",className:"ml-8 flex items-center space-x-5",children:n.map((e=>(0,G.jsx)("li",{children:"complete"===e.status?(0,G.jsx)("span",{className:"block h-2.5 w-2.5 rounded-full bg-[var(--tg-theme-accent-text-color)]"}):"current"===e.status?(0,G.jsxs)("span",{className:"relative flex items-center justify-center","aria-current":"step",children:[(0,G.jsx)("span",{className:"absolute flex h-5 w-5 p-px","aria-hidden":"true",children:(0,G.jsx)("span",{className:"h-full w-full rounded-full bg-[var(--tg-theme-text-color)]"})}),(0,G.jsx)("span",{className:"relative block h-2.5 w-2.5 rounded-full bg-[var(--tg-theme-accent-text-color)]","aria-hidden":"true"})]}):(0,G.jsx)("span",{className:"block h-2.5 w-2.5 rounded-full bg-[var(--tg-theme-text-color)]"})},e.id)))})]})}var $=n(424);const L=o.K.injectEndpoints({endpoints:e=>({getType:e.query({query:()=>({url:"question-type"})}),getTypeById:e.query({query:e=>({url:`question-type/${e}`}),providesTags:["TypeGroup"]}),updateTypeGroups:e.mutation({query:({chat:e,question_type:t})=>({url:`/chat/updateTypeChat/${e}`,method:"PATCH",body:{question_type:t}}),invalidatesTags:["TypeGroup"]})})}),{useGetTypeQuery:K,useGetTypeByIdQuery:V,useUpdateTypeGroupsMutation:R}=L,U=({validate:e})=>{const t=q(),n=S(j),{data:s}=K("");console.log(s);const{data:a}=(0,$.useGetCategoryQuery)("");console.log("allCategory",a);const[o,i]=(0,O.useState)(a&&0!==n?a.find((e=>e.id===n)):{id:0,name:""});console.log("selectedCategory",o);const[r,u]=(0,O.useState)(!1);return e(!!r),(0,G.jsxs)("div",{className:"py-2",children:[(0,G.jsx)(T.SimpleCategorySelect,{value:o||{id:0,name:" "},func:e=>{i(e),t(h(e.id))},data:a||[{id:0,name:" "}]}),(0,G.jsx)("div",{className:"py-4",children:(0,G.jsx)(T.ValidateForm,{text:"Выберите подходящую категорию",data:{value:o?o.id:0,lengthMin:0,lengthMax:0},validation:u})})]})};function H({validate:e}){const t=S(w),[n,s]=(0,O.useState)(t.answerright),[a,o]=(0,O.useState)([{id:1,name:"answer1",value:""},{id:2,name:"answer2",value:""},{id:3,name:"answer3",value:""},{id:4,name:"answer4",value:""}]),i=q(),r=e=>{const t=e.target.name,n=e.target.value,s=a.map((e=>e.name===t?Object.assign({},e,{value:n}):e));o(s),i(m(s))},[u,l]=(0,O.useState)(!1),[c,d]=(0,O.useState)(!1);e(!(!u||!c));const p=e=>{s(e),i(x(e))};return(0,G.jsx)(G.Fragment,{children:(0,G.jsxs)("div",{className:"py-2",children:[a.map((e=>(0,G.jsx)(T.SimpleInputAnswer,{id:e.id,selected:n,value:e.value,funcChange:r,funcButton:p}))),(0,G.jsxs)("div",{className:"py-4",children:[(0,G.jsx)(T.ValidateForm,{text:"Длина текста ответов должна быть не менее 1 не более 35 символов",data:{value:a,lengthMin:1,lengthMax:35},validation:l}),(0,G.jsx)(T.ValidateForm,{text:"Обязательно нужно выбрать верный вариант ответа (вопросы для всех групп проходят модерацию)",data:{value:n,lengthMin:0,lengthMax:0},validation:d})]})]})})}const Y=({success:e})=>{const t=q(),n=S(w),{setMainButtonState:s}=(0,P.Gu)((async function(){u||c(),u&&(await d({text:n.text,chat:521884639,category:n.category,answer1:n.answers[0].value,answer2:n.answers[1].value,answer3:n.answers[2].value,answer4:n.answers[3].value,answerright:n.answerright}),e(!0),t(g()),t(l(!1)))})),a=e=>{s(e)},{steps:o,currentStepIndex:i,step:r,isLastStep:u,next:c}=(0,P.Yj)([(0,G.jsx)(D,{validate:a}),(0,G.jsx)(U,{validate:a}),(0,G.jsx)(H,{validate:a})]),[d,{}]=M();return console.log(S(b.getState)),(0,G.jsxs)(T.Page,{children:[(0,G.jsx)(T.HeaderBlock,{children:(0,G.jsx)(W,{step:i+1,stepsCount:o.length})}),(0,G.jsx)(T.MainBlock,{children:r})]})},z=()=>{const e=window.Telegram.WebApp,t=q(),n=S(y),s=S(v),[a,o]=(0,O.useState)(!1);return(0,P.IV)(n,(()=>t(l(!1)))),(0,O.useEffect)((()=>{a&&(e.MainButton.hide(),e.showConfirm("Вопрос успешно добавлен!",console.log("showPopup")))}),[a]),(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(T.Page,{children:[(0,G.jsx)(T.GlobalHeader,{children:(0,G.jsx)(T.ButtonIcon,{firstIcon:!0,text:"Добавить вопрос",color:"[var(--tg-theme-accent-text-color)]",icon:"add",func:()=>{t(c("addQuestion")),t(l(!0))}})}),(0,G.jsxs)(T.MainBlock,{children:[(0,G.jsx)("div",{className:"text-center pt-9"}),(0,G.jsx)(F,{})]})]}),(0,G.jsx)(T.SlidePage,{slide:n,children:"addQuestion"==s&&(0,G.jsx)(Y,{success:e=>{o(e)}})})]})},J=()=>(0,G.jsx)(G.Fragment,{children:(0,G.jsx)(s.Provider,{store:b,children:(0,G.jsx)(z,{})})})},28:(e,t,n)=>{n.d(t,{K:()=>i});var s=n(392),a=n(280);const o=(0,s.c9)((0,s._)({baseUrl:"https://api80q.ru/viktorinaonlinebot/"}),{maxRetries:5}),i=(0,a.KS)({reducerPath:"vikApi",refetchOnFocus:!0,baseQuery:o,tagTypes:["TypeGroup","TimeGroup","CategoryGroup","Validate","CountAvailableQuestionGroup","CountPublishedQuestionGroup"],endpoints:()=>({})})},460:(e,t,n)=>{n.d(t,{gr:()=>a,_g:()=>i,_W:()=>o,IV:()=>d,Gu:()=>c,Yj:()=>l,IF:()=>r});const s=window.Telegram.WebApp,a=(...e)=>e.filter(Boolean).join(" "),o=()=>{s.showAlert("Данная функция находится в разработке",console.log("inDevelopment"))},i=e=>{if(e)return s.openTelegramLink("https://t.me/more_details")},r=e=>{if("string"==typeof e.value)return!(e.value.length<e.lengthMin||e.value.length>e.lengthMax);if("number"==typeof e.value)return 0!==e.value;if("object"==typeof e.value){let t=0,n=!1;return e.value.map((n=>{n.value.length>=e.lengthMin&&n.value.length<e.lengthMax&&t++})),n=t===e.value.length,n}return!1};var u=n(136);function l(e){const[t,n]=(0,u.useState)(0);return{currentStepIndex:t,step:e[t],steps:e,isFirstStep:0===t,isLastStep:t===e.length-1,goTo:function(e){n(e)},next:function(){n((t=>t>=e.length-1?t:t+1))},back:function(){n((e=>e<=0?e:e-1))}}}const c=e=>{const t=window.Telegram.WebApp,[n,s]=(0,u.useState)(!1);return(0,u.useEffect)((()=>(n?(t.MainButton.setText("Далее"),t.MainButton.show(),t.onEvent("mainButtonClicked",e)):t.MainButton.hide(),()=>{t.MainButton.hide(),t.offEvent("mainButtonClicked",e)})),[n]),{setMainButtonState:s}},d=(e,t)=>{const n=window.Telegram.WebApp;(0,u.useEffect)((()=>{e?(n.BackButton.show(),n.onEvent("backButtonClicked",(n.MainButton.hide(),t))):n.BackButton.hide()}),[e])}},108:(e,t,n)=>{var s=n(136),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var s,o={},l=null,c=null;for(s in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,s)&&!u.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:a,type:e,key:l,ref:c,props:o,_owner:r.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},0:(e,t,n)=>{e.exports=n(108)}}]);