(self.webpackChunkchat_room=self.webpackChunkchat_room||[]).push([[247],{247:(e,t,a)=>{a.r(t);var o=a(179),s=a.n(o),r=a(873),n=a(215),c=a(638);const i=(0,c.createSlice)({name:"chatRoomApp",initialState:{chatRoomSlide:!1,chatRoomType:"",chatRoomChat:{id:0,isLoading:!1,wsErrors:[],isAdmin:!1,nominationCount:0,participantCount:0},chatRoomData:void 0},reducers:{setChatAccessToken:(e,t)=>{e.chatRoomChat.accessToken=t.payload},setChatRoomChatId:(e,t)=>{e.chatRoomChat.id=t.payload},initializePoll:(e,t)=>{e.chatRoomChat.poll=t.payload},loadingChat:(e,t)=>{e.chatRoomChat.isLoading=t.payload},showChatRoomSlide:(e,t)=>{e.chatRoomSlide=t.payload},typeChatRoom:(e,t)=>{e.chatRoomType=t.payload},dataChatRoom:(e,t)=>{e.chatRoomData=t.payload}}}),{showChatRoomSlide:d,typeChatRoom:h,dataChatRoom:l,initializePoll:m,loadingChat:p,setChatAccessToken:u,setChatRoomChatId:x}=i.actions,g=e=>e.chatRoomApp.chatRoomSlide,y=e=>e.chatRoomApp.chatRoomData,R=e=>e.chatRoomApp.chatRoomType,C=e=>e.chatRoomApp.chatRoomChat.id,j=i.reducer;var v=a(420),f=a(885);const S=(0,v.L5)((0,v.cw)({baseUrl:"https://api80q.ru/mdws/chats"})),w=(0,f.xP)({reducerPath:"mdwsApi",refetchOnFocus:!0,baseQuery:S,tagTypes:["Validate"],endpoints:()=>({})}),b=w.injectEndpoints({endpoints:e=>({validate:e.query({query:e=>({url:`/validateUser/${e}`}),providesTags:["Validate"]}),join:e.mutation({query:({chat:e,user:t})=>({url:"/join",method:"POST",body:{chat:e,user:t}})}),getMessage:e.query({query:e=>({url:`/messages/${e}`})})})}),{useValidateQuery:k,useJoinMutation:A,useGetMessageQuery:T}=b,M=(0,c.configureStore)({reducer:{[w.reducerPath]:w.reducer,chatRoomApp:j},middleware:e=>e().concat(w.middleware)}),P=()=>(0,n.useDispatch)(),D=n.useSelector;var E=a(647),N=a(343),U=a(48),q=a(490),B=a(85);const I=({accessToken:e})=>{const t=(0,o.useRef)(null),a=(P(),D(C)),s=D(y),{data:r,isSuccess:n,isLoading:c}=T(a),i=(e=>(0,o.useMemo)((()=>(0,q.io)("https://api80q.ru/chat",{auth:{token:e},transports:["websocket","polling"]})),[]))(e),[d,h]=(0,o.useState)([]),[l,m]=(0,o.useState)("");return(0,o.useEffect)((()=>{t.current&&t.current.scrollIntoView({behavior:"smooth",block:"end"})}),[d]),(0,o.useEffect)((()=>{const e=e=>{h((t=>[...t,e])),console.log("args",e)};i.on("chat_updated",e),i.on("exception",e),i.on("message",e)}),[i]),(0,B.jsxs)(N.A,{children:[c&&(0,B.jsx)(E.Preloader,{}),s&&n&&r.map((e=>e.user!==s.UserData.appUser?(0,B.jsx)(U.A,{name:String(e.user),text:e.text},e.id):(0,B.jsx)(E.MessageMyChat,{text:e.text},e.id))),d&&s&&d.map((e=>"message"===e.type&&e.text?e.user.id!==s.UserData.appUser?(0,B.jsx)(U.A,{name:String(e.user.name),text:e.text.text},e.type):(0,B.jsx)(E.MessageMyChat,{text:e.text.text},e.type):(0,B.jsx)(E.MessageSystem,{name:String(e.user.name),action:e.type,chat:String(e.chat.name)}))),(0,B.jsx)("div",{className:"pb-4",ref:t}),(0,B.jsx)(E.SendPanel,{message:l,handleChange:e=>m(e.target.value),handleSubmit:e=>{e.trim(),""!=e&&(i.emit("message",e),m(""))}})]})},L=({user:e})=>{const t=P(),a=D(g),s=D(R),[r,{data:n}]=A();return((e,t)=>{const a=window.Telegram.WebApp;(0,o.useEffect)((()=>{e?(a.BackButton.show(),a.onEvent("backButtonClicked",(a.MainButton.hide(),t))):a.BackButton.hide()}),[e])})(a,(()=>t(d(!1)))),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("ul",{role:"list",className:"text-left divide-y divide-[var(--tg-theme-hint-color)]",children:(0,B.jsx)(E.Contact,{handelClick:()=>{t(h("openChatRoom")),t(x(10)),t(d(!0)),r({chat:10,user:e.appUser})},img:"photo2024-02-11_17-14-16.jpg",name:"Антонио-Молодец",time:"17.03.24",lastMessage:"...."})}),(0,B.jsx)(E.SlidePage,{slide:a,children:"openChatRoom"==s&&n&&(0,B.jsx)(I,{accessToken:n.accessToken})})]})},V=()=>{const e=window.Telegram.WebApp,t=P(),{data:a,isSuccess:o}=k(e.initData);return o&&t(l(a)),(0,B.jsx)(B.Fragment,{children:a&&(0,B.jsx)(L,{user:a.UserData})})},_=()=>{const e=window.Telegram.WebApp;return s().useEffect((()=>{e.expand(),e.ready()}),[]),(0,B.jsx)(n.Provider,{store:M,children:(0,B.jsx)(V,{})})};r.H(document.getElementById("root")).render((0,B.jsx)(o.StrictMode,{children:(0,B.jsx)(_,{})}))},343:(e,t,a)=>{a.d(t,{A:()=>r,X:()=>s});var o=a(85);function s({children:e}){return(0,o.jsx)("div",{className:"flex flex-col px-2 overflow-auto w-screen h-screen pb-16",children:e})}const r=s},48:(e,t,a)=>{a.d(t,{A:()=>r,e:()=>s});var o=a(85);function s({name:e,text:t}){const a=new Date;return(0,o.jsx)("div",{className:"flex mb-2",children:(0,o.jsxs)("div",{className:"rounded py-2 px-3 bg-[var(--tg-theme-hint-color)] max-w-[75%]",children:[(0,o.jsx)("p",{className:"text-sm text-left text-[var(--tg-theme-bg-color)]",children:e}),(0,o.jsx)("p",{className:"text-sm mt-4 text-left text-[var(--tg-theme-bg-color)]",children:t}),(0,o.jsx)("p",{className:"text-left text-xs text-[var(--tg-theme-bg-color)] mt-4",children:a.toString()})]})})}const r=s},873:(e,t,a)=>{var o=a(67);t.H=o.createRoot,o.hydrateRoot}}]);