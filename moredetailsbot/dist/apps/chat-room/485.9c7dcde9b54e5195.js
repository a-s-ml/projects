(self.webpackChunkchat_room=self.webpackChunkchat_room||[]).push([[485],{485:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var o=a(215),s=a(638);const c=(0,s.createSlice)({name:"chatRoomApp",initialState:{chatRoomSlide:!1,chatRoomType:"",chatRoomChat:{isLoading:!1,wsErrors:[],isAdmin:!1,nominationCount:0,participantCount:0},chatRoomData:void 0},reducers:{setChatAccessToken:(e,t)=>{e.chatRoomChat.accessToken=t.payload},initializePoll:(e,t)=>{e.chatRoomChat.poll=t.payload},loadingChat:(e,t)=>{e.chatRoomChat.isLoading=t.payload},showChatRoomSlide:(e,t)=>{e.chatRoomSlide=t.payload},typeChatRoom:(e,t)=>{e.chatRoomType=t.payload},dataChatRoom:(e,t)=>{e.chatRoomData=t.payload}}}),{showChatRoomSlide:n,typeChatRoom:i,dataChatRoom:r,initializePoll:l,loadingChat:d,setChatAccessToken:h}=c.actions,m=e=>e.chatRoomApp.chatRoomSlide,p=e=>e.chatRoomApp.chatRoomData,u=e=>e.chatRoomApp.chatRoomType,x=c.reducer;var g=a(420),R=a(885);const v=(0,g.L5)((0,g.cw)({baseUrl:"https://api80q.ru/mdws/chats"})),j=(0,R.xP)({reducerPath:"mdwsApi",refetchOnFocus:!0,baseQuery:v,tagTypes:["Validate"],endpoints:()=>({})}),C=j.injectEndpoints({endpoints:e=>({validate:e.query({query:e=>({url:`chat/validateUser/${e}`}),providesTags:["Validate"]}),join:e.mutation({query:({chat:e,user:t})=>({url:"/join",method:"POST",body:{chat:e,user:t}})})})}),{useValidateQuery:y,useJoinMutation:w}=C,k=(0,s.configureStore)({reducer:{[j.reducerPath]:j.reducer,chatRoomApp:x},middleware:e=>e().concat(j.middleware)}),S=()=>(0,o.useDispatch)(),f=o.useSelector;var A=a(179),T=a(647),b=a(343),N=a(48),P=a(490),B=a(85);const D=({accessToken:e})=>{console.log("accessToken",e);const[t,a]=(0,A.useState)([]);return(0,A.useEffect)((()=>{const t=(0,P.io)("https://api80q.ru/chat",{auth:{token:e},transports:["websocket","polling"]}),o=e=>{a((t=>[...t,e]))};t.on("chat_updated",o),t.on("exception",o),t.on("message",o)}),[e]),console.log("state ",t),(0,B.jsx)(b.A,{children:t&&t.map((e=>e.text?(0,B.jsx)(N.A,{name:String(e.user),text:e.text,time:String(e.chat)},e.id):(0,B.jsx)(T.MessageSystem,{name:String(e.user),action:"присоединился",chat:String(e.chat)})))})},q=({user:e})=>{const t=S(),a=f(m),o=f(u),s=f(p);console.log(e),console.log(s);const[c,{data:r}]=w();return((e,t)=>{const a=window.Telegram.WebApp;(0,A.useEffect)((()=>{e?(a.BackButton.show(),a.onEvent("backButtonClicked",(a.MainButton.hide(),t))):a.BackButton.hide()}),[e])})(a,(()=>t(n(!1)))),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("ul",{role:"list",className:"text-left divide-y divide-[var(--tg-theme-hint-color)]",children:(0,B.jsx)(T.Contact,{handelClick:()=>{t(i("openChatRoom")),t(n(!0)),c({chat:10,user:e.id})},img:"photo2024-02-11_17-14-16.jpg",name:"Антонио-Молодец",time:"17.03.24",lastMessage:"...."})}),(0,B.jsx)(T.SlidePage,{slide:a,children:"openChatRoom"==o&&(0,B.jsx)(D,{accessToken:null==r?void 0:r.accessToken})})]})},E=()=>{const e=window.Telegram.WebApp,t=S(),{data:a,isSuccess:o,isLoading:s}=y(e.initData);return o&&t(r(a)),(0,B.jsx)(B.Fragment,{children:a&&(0,B.jsx)(q,{user:a.UserData.user})})},L=()=>(0,B.jsx)(o.Provider,{store:k,children:(0,B.jsx)(E,{})})},343:(e,t,a)=>{a.d(t,{A:()=>c,X:()=>s});var o=a(85);function s({children:e}){return(0,o.jsx)("div",{className:"flex-1 overflow-auto w-screen h-screen px-5",children:(0,o.jsx)("div",{className:"py-2 px-3",children:e})})}const c=s},48:(e,t,a)=>{a.d(t,{A:()=>c,e:()=>s});var o=a(85);function s({name:e,text:t,time:a}){return(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:"flex mb-2 max-w-[75%]",children:(0,o.jsxs)("div",{className:"rounded py-2 px-3 bg-[var(--tg-theme-hint-color)]",children:[(0,o.jsxs)("p",{className:"text-sm text-[var(--tg-theme-bg-color)]",children:["Имя: ",e]}),(0,o.jsx)("p",{className:"text-sm mt-1 text-[var(--tg-theme-text-color)]",children:t}),(0,o.jsx)("p",{className:"text-right text-xs text-[var(--tg-theme-bg-color)] mt-1",children:a})]})})})}const c=s}}]);