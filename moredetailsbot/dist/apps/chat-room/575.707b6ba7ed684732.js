(self.webpackChunkchat_room=self.webpackChunkchat_room||[]).push([[575],{575:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var o=a(215),s=a(638);const r=(0,s.createSlice)({name:"chatRoomApp",initialState:{chatRoomSlide:!1,chatRoomType:"",chatRoomChat:{id:0,isLoading:!1,wsErrors:[],isAdmin:!1,nominationCount:0,participantCount:0},chatRoomData:void 0},reducers:{setChatAccessToken:(e,t)=>{e.chatRoomChat.accessToken=t.payload},setChatRoomChatId:(e,t)=>{e.chatRoomChat.id=t.payload},initializePoll:(e,t)=>{e.chatRoomChat.poll=t.payload},loadingChat:(e,t)=>{e.chatRoomChat.isLoading=t.payload},showChatRoomSlide:(e,t)=>{e.chatRoomSlide=t.payload},typeChatRoom:(e,t)=>{e.chatRoomType=t.payload},dataChatRoom:(e,t)=>{e.chatRoomData=t.payload}}}),{showChatRoomSlide:n,typeChatRoom:c,dataChatRoom:i,initializePoll:h,loadingChat:d,setChatAccessToken:l,setChatRoomChatId:m}=r.actions,u=e=>e.chatRoomApp.chatRoomSlide,p=e=>e.chatRoomApp.chatRoomData,x=e=>e.chatRoomApp.chatRoomType,g=e=>e.chatRoomApp.chatRoomChat.id,C=r.reducer;var R=a(420),y=a(885);const j=(0,R.L5)((0,R.cw)({baseUrl:"https://api80q.ru/mdws/chats"})),v=(0,y.xP)({reducerPath:"mdwsApi",refetchOnFocus:!0,baseQuery:j,tagTypes:["Validate"],endpoints:()=>({})}),S=v.injectEndpoints({endpoints:e=>({validate:e.query({query:e=>({url:`/validateUser/${e}`}),providesTags:["Validate"]}),join:e.mutation({query:({chat:e,user:t})=>({url:"/join",method:"POST",body:{chat:e,user:t}})}),getMessage:e.query({query:e=>({url:`/messages/${e}`})})})}),{useValidateQuery:w,useJoinMutation:f,useGetMessageQuery:k}=S,b=(0,s.configureStore)({reducer:{[v.reducerPath]:v.reducer,chatRoomApp:C},middleware:e=>e().concat(v.middleware)}),A=()=>(0,o.useDispatch)(),T=o.useSelector;var M=a(179),P=a(647),D=a(343),N=a(48),U=a(490),q=a(85);const B=({accessToken:e})=>{const t=(0,M.useRef)(null),a=(A(),T(g)),o=T(p),{data:s,isSuccess:r,isLoading:n}=k(a),c=(e=>(0,M.useMemo)((()=>(0,U.io)("https://api80q.ru/chat",{auth:{token:e},transports:["websocket","polling"]})),[]))(e),[i,h]=(0,M.useState)([]),[d,l]=(0,M.useState)("");return(0,M.useEffect)((()=>{t.current&&t.current.scrollIntoView({behavior:"smooth",block:"end"})}),[i]),(0,M.useEffect)((()=>{const e=e=>{h((t=>[...t,e])),console.log("args",e)};c.on("chat_updated",e),c.on("exception",e),c.on("message",e)}),[c]),(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(D.A,{children:[n&&(0,q.jsx)(P.Preloader,{}),o&&r&&s.map((e=>e.user!==o.UserData.appUser?(0,q.jsx)(N.A,{name:String(e.user),text:e.text},e.id):(0,q.jsx)(P.MessageMyChat,{text:e.text},e.id))),i&&o&&i.map((e=>"message"===e.type&&e.text?e.user.id!==o.UserData.appUser?(0,q.jsx)(N.A,{name:String(e.user.name),text:e.text.text},e.type):(0,q.jsx)(P.MessageMyChat,{text:e.text.text},e.type):(0,q.jsx)(P.MessageSystem,{name:String(e.user.name),action:e.type,chat:String(e.chat.name)}))),(0,q.jsx)("div",{ref:t})]}),(0,q.jsx)(P.SendPanel,{message:d,handleChange:e=>l(e.target.value),handleSubmit:e=>{e.trim(),""!=e&&(c.emit("message",e),l(""))}})]})},E=({user:e})=>{const t=A(),a=T(u),o=T(x),[s,{data:r}]=f();return((e,t)=>{const a=window.Telegram.WebApp;(0,M.useEffect)((()=>{e?(a.BackButton.show(),a.onEvent("backButtonClicked",(a.MainButton.hide(),t))):a.BackButton.hide()}),[e])})(a,(()=>t(n(!1)))),(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("ul",{role:"list",className:"text-left divide-y divide-[var(--tg-theme-hint-color)]",children:(0,q.jsx)(P.Contact,{handelClick:()=>{t(c("openChatRoom")),t(m(10)),t(n(!0)),s({chat:10,user:e.appUser})},img:"photo2024-02-11_17-14-16.jpg",name:"Антонио-Молодец",time:"17.03.24",lastMessage:"...."})}),(0,q.jsx)(P.SlidePage,{slide:a,children:"openChatRoom"==o&&r&&(0,q.jsx)(B,{accessToken:r.accessToken})})]})},F=()=>{const e=window.Telegram.WebApp,t=A(),{data:a,isSuccess:o}=w(e.initData);return o&&t(i(a)),(0,q.jsx)(q.Fragment,{children:a&&(0,q.jsx)(E,{user:a.UserData})})},L=()=>(0,q.jsx)(o.Provider,{store:b,children:(0,q.jsx)(F,{})})},343:(e,t,a)=>{a.d(t,{A:()=>r,X:()=>s});var o=a(85);function s({children:e}){return(0,o.jsx)("div",{className:"flex overflow-auto w-screen h-screen",children:(0,o.jsx)("div",{className:"pt-2 px-3 pb-32",children:e})})}const r=s},48:(e,t,a)=>{a.d(t,{A:()=>r,e:()=>s});var o=a(85);function s({name:e,text:t}){const a=new Date;return(0,o.jsx)("div",{className:"flex mb-2",children:(0,o.jsxs)("div",{className:"rounded py-2 px-3 bg-[var(--tg-theme-hint-color)] max-w-[75%]",children:[(0,o.jsx)("p",{className:"text-sm text-[var(--tg-theme-bg-color)]",children:e}),(0,o.jsx)("p",{className:"text-sm mt-4 text-[var(--tg-theme-text-color)]",children:t}),(0,o.jsx)("p",{className:"text-right text-xs text-[var(--tg-theme-bg-color)] mt-4",children:a.toString()})]})})}const r=s}}]);