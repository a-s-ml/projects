(self.webpackChunkchat_room=self.webpackChunkchat_room||[]).push([[575],{575:(e,t,a)=>{a.r(t),a.d(t,{default:()=>q});var o=a(215),s=a(638);const n=(0,s.createSlice)({name:"chatRoomApp",initialState:{chatRoomSlide:!1,chatRoomType:"",chatRoomChat:{isLoading:!1,wsErrors:[],isAdmin:!1,nominationCount:0,participantCount:0},chatRoomData:void 0},reducers:{setChatAccessToken:(e,t)=>{e.chatRoomChat.accessToken=t.payload},initializePoll:(e,t)=>{e.chatRoomChat.poll=t.payload},loadingChat:(e,t)=>{e.chatRoomChat.isLoading=t.payload},showChatRoomSlide:(e,t)=>{e.chatRoomSlide=t.payload},typeChatRoom:(e,t)=>{e.chatRoomType=t.payload},dataChatRoom:(e,t)=>{e.chatRoomData=t.payload}}}),{showChatRoomSlide:c,typeChatRoom:r,dataChatRoom:i,initializePoll:d,loadingChat:l,setChatAccessToken:h}=n.actions,m=e=>e.chatRoomApp.chatRoomSlide,p=e=>e.chatRoomApp.chatRoomData,u=e=>e.chatRoomApp.chatRoomType,x=n.reducer;var g=a(420),j=a(885);const R=(0,g.L5)((0,g.cw)({baseUrl:"https://api80q.ru/mdws/chats"})),v=(0,j.xP)({reducerPath:"mdwsApi",refetchOnFocus:!0,baseQuery:R,tagTypes:["Validate"],endpoints:()=>({})}),C=v.injectEndpoints({endpoints:e=>({validate:e.query({query:e=>({url:`/validateUser/${e}`}),providesTags:["Validate"]}),join:e.mutation({query:({chat:e,user:t})=>({url:"/join",method:"POST",body:{chat:e,user:t}})})})}),{useValidateQuery:y,useJoinMutation:S}=C,w=(0,s.configureStore)({reducer:{[v.reducerPath]:v.reducer,chatRoomApp:x},middleware:e=>e().concat(v.middleware)}),k=()=>(0,o.useDispatch)(),b=o.useSelector;var f=a(179),A=a(647),T=a(343),D=a(48),P=a(490),U=a(85);const N=({accessToken:e})=>{const t=b(p);console.log("dataUser",t);const a=(e=>(0,f.useMemo)((()=>(0,P.io)("https://api80q.ru/chat",{auth:{token:e},transports:["websocket","polling"]})),[]))(e),[o,s]=(0,f.useState)([]),[n,c]=(0,f.useState)("");return(0,f.useEffect)((()=>{const e=e=>{s((t=>[...t,e])),console.log("state",o),console.log("args",e)};a.on("chat_updated",e),a.on("exception",e),a.on("message",e)}),[a]),(0,U.jsxs)(T.A,{children:[o&&t&&o.map((e=>e.text?t&&e.user!==t.UserData.appUser?(0,U.jsx)(D.A,{name:String(t.UserData.user.username),text:e.text},e.id):(0,U.jsx)(A.MessageMyChat,{text:e.text},e.id):(0,U.jsx)(A.MessageSystem,{name:String(t.UserData.user.username),action:"присоединился",chat:String(e.chat)}))),(0,U.jsx)(A.SendPanel,{message:n,handleChange:e=>c(e.target.value),handleSubmit:e=>{a.emit("message",e),c("")}})]})},M=({user:e})=>{const t=k(),a=b(m),o=b(u),[s,{data:n}]=S();return((e,t)=>{const a=window.Telegram.WebApp;(0,f.useEffect)((()=>{e?(a.BackButton.show(),a.onEvent("backButtonClicked",(a.MainButton.hide(),t))):a.BackButton.hide()}),[e])})(a,(()=>t(c(!1)))),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("ul",{role:"list",className:"text-left divide-y divide-[var(--tg-theme-hint-color)]",children:(0,U.jsx)(A.Contact,{handelClick:()=>{t(r("openChatRoom")),t(c(!0)),s({chat:10,user:e.appUser})},img:"photo2024-02-11_17-14-16.jpg",name:"Антонио-Молодец",time:"17.03.24",lastMessage:"...."})}),(0,U.jsx)(A.SlidePage,{slide:a,children:"openChatRoom"==o&&n&&(0,U.jsx)(N,{accessToken:n.accessToken})})]})},B=()=>{const e=window.Telegram.WebApp,t=k(),{data:a,isSuccess:o,isLoading:s}=y(e.initData);return o&&t(i(a)),(0,U.jsx)(U.Fragment,{children:a&&(0,U.jsx)(M,{user:a.UserData})})},q=()=>(0,U.jsx)(o.Provider,{store:w,children:(0,U.jsx)(B,{})})},343:(e,t,a)=>{a.d(t,{A:()=>n,X:()=>s});var o=a(85);function s({children:e}){return(0,o.jsx)("div",{className:"flex-1 overflow-auto w-screen h-screen",children:(0,o.jsx)("div",{className:"pt-2 px-3 pb-32",children:e})})}const n=s},48:(e,t,a)=>{a.d(t,{A:()=>n,e:()=>s});var o=a(85);function s({name:e,text:t}){const a=new Date;return(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:"flex mb-2 max-w-[75%]",children:(0,o.jsxs)("div",{className:"rounded py-2 px-3 bg-[var(--tg-theme-hint-color)]",children:[(0,o.jsx)("p",{className:"text-sm text-[var(--tg-theme-bg-color)]",children:e}),(0,o.jsx)("p",{className:"text-sm mt-4 text-[var(--tg-theme-text-color)]",children:t}),(0,o.jsx)("p",{className:"text-right text-xs text-[var(--tg-theme-bg-color)] mt-4",children:a.toString()})]})})})}const n=s}}]);